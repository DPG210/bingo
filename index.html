<!DOCTYPE html>
<html>
<head>
    <title>Bingo Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        body { background: #0F1123; color: white; font-family: sans-serif; text-align: center; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 20px; max-width: 400px; margin: auto; }
        .cell { background: #252A4E; padding: 20px; border-radius: 10px; font-weight: bold; font-size: 1.2rem; cursor: pointer; border: 2px solid transparent; }
        .marked { background: #FFD700; color: #0F1123; border-color: white; }
        .last-num { font-size: 3rem; color: #FFD700; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>SALA: <span id="sala-id">---</span></h1>
    <div class="last-num" id="last-ball">--</div>
    <div class="grid" id="carton"></div>

    <script>
        // 1. Configuración Firebase (Usa la misma que en MAUI)
        const firebaseConfig = { databaseURL: "https://bingov3-1ec3a-default-rtdb.europe-west1.firebasedatabase.app/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. Obtener sala de la URL (?sala=1234)
        const urlParams = new URLSearchParams(window.location.search);
        const sala = urlParams.get('sala');
        document.getElementById('sala-id').innerText = sala;

        // 3. Generar cartón de 15 números (5 por fila)
        const cartonDiv = document.getElementById('carton');
        let numeros = [];
        while(numeros.length < 15) {
            let n = Math.floor(Math.random() * 90) + 1;
            if(!numeros.includes(n)) numeros.push(n);
        }
        numeros.sort((a,b) => a-b).forEach(n => {
            const div = document.createElement('div');
            div.className = 'cell';
            div.innerText = n;
            div.onclick = () => div.classList.toggle('marked');
            cartonDiv.appendChild(div);
        });

        // 4. Escuchar el número que saca el Admin
        db.ref(`Salas/${sala}/Ultima`).on('value', (snapshot) => {
            const val = snapshot.val();
            if(val) document.getElementById('last-ball').innerText = val;
        });
    </script>
</body>
</html>